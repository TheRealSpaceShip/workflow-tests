name: 'Test'

on:
  workflow_dispatch:
    inputs:
      stringInput:
        description: 'This is string input'
        required: false
        default: 'stringInput'
      booleanInput:
        type: boolean
        description: 'This is boolean input'
        required: false
        default: false
      choiseInput:
        type: choice
        description: 'This is choise input'
        required: false
        options:
          - choise1
          - choise2
          - choise3
        default: 'choise2'

env:
  TEST_ENV: "This is test env with var $TEST_VAR"

jobs:
  json:
    runs-on: 'ubuntu-latest'
    outputs:
      myjson: ${{ steps.myjson.outputs.json }}
    steps:
      - id: myjson
        name: JSON
        run: |
          echo "json=\"{\"test\":\"test value\"}\"" >> $GITHUB_OUTPUT

  test:
    needs: json
    runs-on: 'ubuntu-latest'
    steps:
      - name: Test env var
        env:
          TEST_VAR: Im test var
        run: |
          echo "${{ needs.json.outputs.myjson.test }}"

  test-condition:
    runs-on: 'ubuntu-latest'
    if: inputs.booleanInput
    steps:
      -
        id: 'test'
        name: 'Test inputs with conditions'
        env:
          STRING_INPUT: ${{ inputs.stringInput }}
          BOOLEAN_INPUT: ${{ inputs.booleanInput }}
          CHOISE_INPUT: ${{ inputs.choiseInput }}
        run: |
          echo "STRING_INPUT=$STRING_INPUT"
          echo "BOOLEAN_INPUT=$BOOLEAN_INPUT"
          echo "CHOISE_INPUT=$CHOISE_INPUT"

  test-negative-condition:
    runs-on: 'ubuntu-latest'
    if: '!inputs.booleanInput'
    steps:
      -
        id: 'test'
        name: 'Test inputs'
        env:
          STRING_INPUT: ${{ inputs.stringInput }}
          BOOLEAN_INPUT: ${{ inputs.booleanInput }}
          CHOISE_INPUT: ${{ inputs.choiseInput }}
        run: |
          echo "STRING_INPUT=$STRING_INPUT"
          echo "BOOLEAN_INPUT=$BOOLEAN_INPUT"
          echo "CHOISE_INPUT=$CHOISE_INPUT"
